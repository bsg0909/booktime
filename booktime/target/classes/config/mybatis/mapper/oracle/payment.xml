<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mybatis.mapper.payment">
	<insert id="insertPayment" parameterType="paymentVo">
		insert into payment(payNo, userid, email1, email2
			, nonMember, price, usePoint, instrument
			, zipcode, parselAddress, newAddress, addressDetail
			, progress, customerName, message, hp)
		values(#{payNo}, #{userid}, #{email1}, #{email2}
			, #{nonMember}, #{price}, #{usePoint}, #{instrument}
			, #{zipcode}, #{parselAddress}, #{newAddress}, #{addressDetail}
			, #{progress}, #{customerName}, #{message}, #{hp})
	</insert>
	
	<insert id="insertPaymentDetail" parameterType="map">
		insert into paymentDetail
		values(#{payNo}, #{isbn}, #{bookName}, #{qty}, #{price})
	</insert>
	
	<select id="selectPaymentByPayNo" parameterType="paymentVo" resultType="paymentVo">
		select * from payment
		<if test="nonMember!=0">
			where nonMember=#{nonMember}
		</if>
		<if test="nonMember==0">
			where userid=#{userid} and payNo=#{payNo}
		</if>
	</select>
	
	<select id="selectPaymentDetail" parameterType="String" resultType="paymentDetailVo">
		select * from paymentDetail
		where payNo=#{payNo}
	</select>
	
	<select id="selectPaymentList" parameterType="paymentDateVO" resultType="paymentVo">
		select *
		from
		(
			select rownum as "RNUM", A.* 
			from
			(
				select * from payment
				<if test="userid!=null and userid!=''">
					where userid=#{userid}
					<if test="startDay!=null and startDay!=''">
						and payDate >= #{startDay}
					</if> 
					<![CDATA[
						and payDate < to_date(#{endDay})+(interval '1' day)
					]]>
				</if>
				<if test="(userid==null or userid=='') and payNo!=null and payNo!=''">
					where payNo=#{payNo}
				</if>
				
				order by payDate desc
			)A
		)
		<if test="userid!=null and userid!=''">
			where "RNUM">=#{firstRecordIndex}+1 
			<![CDATA[
			and "RNUM"<#{firstRecordIndex}+1+#{recordCountPerPage}
			]]>
		</if>
	</select>
		
	<select id="totalPaymentList" parameterType="paymentDateVO" resultType="int">
		select count(*) from payment
		where userid=#{userid}
		<if test="startDay!=null and startDay!=''">
			and payDate > #{startDay}
		</if> 
		<![CDATA[
			and payDate < to_date(#{endDay})+(interval '1' day)
		]]>
	</select>
</mapper>









